{% extends  "base.html.twig" %}
{% trans_default_domain 'TkuskaDashboardBundle' %}

{% block page_head %}{% trans %}dashboard{% endtrans %} {{ renderWidgetSelector() }} {%endblock %}
{% block javascripts %}
{# j'ai déplacé le code dans le body il marchait toute façon pas ici #}
{% endblock %}
{% block body -%}
     

{# là j'ai essayé d'importer de manière sauvage les biblis JS mais le navigateur n'arrive pas à les télécharger - les liens marchent pourtant #}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.min.css"/>
<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.min.js'></script>
<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.jQueryUI.min.js'></script>

{{ parent() }}
    <script type="text/javascript">
        $(function () {
            $('.grid-stack').gridstack({
                width: 12,
                animate: true,
                always_show_resize_handle: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                resizable: {
                    handles: 'e, se, s'
                }
            });
            var grid = $('.grid-stack').data('gridstack');

            $('.close').click(function () {
                var widget = $(this).closest('.grid-stack-item');
                var alias = widget.data('widget-type');
                $.ajax(Routing.generate('remove_widget', {alias: alias}));
                grid.remove_widget(widget);
            });
            $('.grid-stack').on('change', function (e, items) {
                $.each(items, function (index, element) {
                    var alias = element.el.data('widget-type');
                    $.ajax(Routing.generate('update_widget', {alias: alias, x: element.x, y: element.y, width: element.width, height: element.height}));
                })
            });
        });
    </script>

    {{ renderWidgetSelector() }}
    <div class="grid-stack" data-gs-animate="yes">
        {% for widget in widgets %}
            {{ renderWidget(widget) }}
        {% endfor %}
    </div>
{% endblock %}